
{{ $format := $.format | default site.Params.format | default "json" }}

{{ $limit := 1 }}
{{ with $.iterations }}
  {{ $limit = . }}
{{ end }}

{{ $content := dict "min" 1 "max" 5 }}
{{ with .content }}
  {{ $content = merge $content . }}
{{ end }}
{{ $info_number := 0 }}
{{ range $iteration := seq 1 $limit }}
  {{ with index site.Data $.name }}
    {{ $info_number = add $info_number (len .) }}
    {{ range . }}
      {{ $entry := partial (printf "transformers/default") (dict 
        "iteration" $iteration
        "content" $content
        "data" .
      ) }}
      {{ $filename := printf "content/%s/%s.md" $.name (urlize $entry.front_matter.title) }}
      {{ $file := dict }}
      {{ if eq $format "json" "yaml_raw" }}
        {{ $front_matter := jsonify $entry.front_matter }}
        {{ $string := print $front_matter "\n\n" $entry.content }}
        {{ if eq $format "yaml_raw" }}
          {{ $front_matter = $front_matter | transform.Remarshal "yaml" }}
          {{ $string = printf "---\n%s---\n\n%s" $front_matter $entry.content }}
        {{ end }}
        
        {{ $file = $string | resources.FromString $filename }}
      {{ else if eq $format "yaml" }}
        {{ $yaml_template := resources.Get "entry.yaml" }}
        {{ $file = $yaml_template | resources.ExecuteAsTemplate $filename $entry }}
      {{ end }}
      {{ $file.Publish }}
    {{ end }}
  {{ end }}
{{ end }}

{{ return (dict
  "number" $info_number
) }}